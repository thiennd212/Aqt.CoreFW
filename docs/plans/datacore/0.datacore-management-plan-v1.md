# Kế hoạch triển khai chức năng quản lý Danh mục Dữ liệu Cốt lõi (DataCore Management) - v1

## 0. Phân tích nghiệp vụ

### 0.1. Mục tiêu
- Xây dựng chức năng cho phép người quản trị hệ thống hoặc người dùng được cấp quyền quản lý danh mục các Dữ liệu Cốt lõi (DataCore) trong hệ thống.
- Mỗi DataCore sẽ thuộc về một DataGroup đã được định nghĩa trước.
- Đảm bảo dữ liệu DataCore (Mã, Tên, Trạng thái, Thứ tự, Mô tả, IdDataGroup) là nhất quán, chính xác.

### 0.2. Đối tượng sử dụng
- Quản trị viên hệ thống.
- Người dùng được cấp quyền quản lý danh mục Dữ liệu Cốt lõi.

### 0.3. Yêu cầu chức năng chính (CRUD)
- **Xem danh sách (Read):** Hiển thị danh sách các DataCore đã có trong hệ thống dưới dạng bảng. Hỗ trợ tìm kiếm theo Mã (`Code`) hoặc Tên (`Name`), lọc theo Trạng thái (`Status`), lọc theo Nhóm dữ liệu (`DataGroupId`). Hỗ trợ phân trang và sắp xếp theo các cột dữ liệu chính (Mã, Tên, Thứ tự, Trạng thái, Tên Nhóm dữ liệu).
- **Thêm mới (Create):** Cho phép người dùng thêm một DataCore mới. Yêu cầu nhập Mã (`Code`), Tên (`Name`), Thứ tự hiển thị (`Order`), Mô tả (`Description` - tùy chọn), Trạng thái (`Status`), chọn Nhóm dữ liệu (`DataGroupId`).
- **Sửa (Update):** Cho phép người dùng chỉnh sửa thông tin (Tên, Thứ tự, Mô tả, Trạng thái, Nhóm dữ liệu) của một DataCore đã tồn tại. Mã (`Code`) không được phép sửa sau khi tạo.
- **Xóa (Delete):** Cho phép người dùng xóa một DataCore. Sử dụng cơ chế xóa mềm (Soft Delete). Cần có bước xác nhận trước khi xóa.
- **(Tùy chọn) Xuất Excel (Export):** Cho phép người dùng xuất danh sách DataCore (có thể dựa trên kết quả lọc hiện tại) ra file định dạng Excel.

### 0.4. Yêu cầu dữ liệu (Dựa trên `datacore-srs.md`)
- **Mã (Code):**
    - Kiểu dữ liệu: Chuỗi (`string`).
    - Bắt buộc nhập.
    - Độ dài tối đa: `DataCoreConsts.MaxCodeLength`.
    - Phải là duy nhất (unique) trong cùng một `DataGroupId` (cần xem xét lại yêu cầu này, có thể cần duy nhất toàn hệ thống).
- **Tên (Name):**
    - Kiểu dữ liệu: Chuỗi (`string`).
    - Bắt buộc nhập.
    - Độ dài tối đa: `DataCoreConsts.MaxNameLength`.
- **Trạng thái (Status):**
    - Kiểu dữ liệu: Enum `DataCoreStatus` (`Active`, `Inactive`).
    - Bắt buộc.
    - Giá trị mặc định: `Active`.
- **Thứ tự hiển thị (Order):**
    - Kiểu dữ liệu: Số nguyên (`int`).
    - Bắt buộc.
    - Giá trị mặc định: `0`.
- **Mô tả (Description):**
    - Kiểu dữ liệu: Chuỗi (`string`).
    - Không bắt buộc.
    - Độ dài tối đa: `DataCoreConsts.MaxDescriptionLength`.
- **Id Nhóm dữ liệu (DataGroupId):**
    - Kiểu dữ liệu: `Guid`.
    - Bắt buộc.
    - Tham chiếu đến khóa chính của `DataGroup`.
- **Thông tin Audit:** Kế thừa từ `FullAuditedEntity<Guid>` để lưu thông tin tạo/sửa/xóa. (Lưu ý: Không phải AggregateRoot nếu DataCore không phải là gốc Aggregate).

### 0.5. Yêu cầu giao diện người dùng (UI)
- **Màn hình danh sách:**
    - Ô tìm kiếm chung (lọc theo Mã hoặc Tên).
    - Bộ lọc Trạng thái (dropdown: "Tất cả", "Hoạt động", "Không hoạt động").
    - Bộ lọc Nhóm dữ liệu (dropdown/lookup).
    - Bảng hiển thị các cột: Mã, Tên, Thứ tự, Trạng thái, Tên Nhóm dữ liệu.
    - Nút "Thêm mới Danh mục DL Cốt lõi".
    - Các nút hành động (Sửa, Xóa) trên mỗi dòng của bảng.
    - Phân trang.
- **Modal Thêm mới/Sửa:**
    - Form nhập liệu cho Mã (chỉ cho phép nhập khi thêm mới), Tên, Thứ tự, Mô tả, Trạng thái (checkbox/radio), Nhóm dữ liệu (dropdown/lookup).
    - Các nút Lưu và Hủy.

### 0.6. Yêu cầu về phân quyền
- Định nghĩa nhóm quyền: `CoreFW.DataCoreManagement`. *(Sử dụng tiền tố để tránh trùng lặp)*
- Các quyền cụ thể:
    - `CoreFW.DataCoreManagement.DataCores` (Quyền xem danh sách - mặc định)
    - `CoreFW.DataCoreManagement.DataCores.Create`
    - `CoreFW.DataCoreManagement.DataCores.Update`
    - `CoreFW.DataCoreManagement.DataCores.Delete`
    - `CoreFW.DataCoreManagement.DataCores.Export` *(Nếu triển khai chức năng Export)*
- Giao diện cần ẩn/hiện các nút chức năng dựa trên quyền của người dùng đang đăng nhập.

### 0.7. Quy tắc nghiệp vụ
- Mã (`Code`) phải là duy nhất trong phạm vi một `DataGroupId` (hoặc toàn hệ thống - cần xác nhận lại).
- Khi thêm mới hoặc sửa, phải kiểm tra tính duy nhất của Mã (trong phạm vi `DataGroupId` hoặc toàn hệ thống, bỏ qua bản ghi hiện tại khi sửa).
- Khi thêm mới hoặc sửa, phải kiểm tra `DataGroupId` được chọn có tồn tại và hợp lệ.
- Tên (`Name`) không yêu cầu là duy nhất.

**Lưu ý chung:** Luôn luôn cập nhật kết quả mỗi bước sau khi hoàn thành vào tệp kế hoạch tương ứng.

## Tóm tắt Tiến độ Thực hiện Dự kiến

- [ ] **Bước 0: Kế hoạch tổng thể** - File này
- [ ] **Bước 1: Tầng Domain.Shared (`Aqt.CoreFW.Domain.Shared`)** - Xem chi tiết: [1.datacore-management-domain-shared-plan.md](./1.datacore-management-domain-shared-plan.md)
- [ ] **Bước 2: Tầng Domain (`Aqt.CoreFW.Domain`)** - Xem chi tiết: [2.datacore-management-domain-plan.md](./2.datacore-management-domain-plan.md) (Chưa tạo)
- [ ] **Bước 3: Tầng Application.Contracts (`Aqt.CoreFW.Application.Contracts`)** - Xem chi tiết: [3.datacore-management-app-contracts-plan.md](./3.datacore-management-app-contracts-plan.md) (Chưa tạo)
- [ ] **Bước 4: Tầng Application (`Aqt.CoreFW.Application`)** - Xem chi tiết: [4.datacore-management-application-plan.md](./4.datacore-management-application-plan.md) (Chưa tạo)
- [ ] **Bước 5: Tầng EntityFrameworkCore (`Aqt.CoreFW.EntityFrameworkCore`)** - Xem chi tiết: [5.datacore-management-efcore-plan.md](./5.datacore-management-efcore-plan.md) (Chưa tạo)
- [ ] **Bước 6: Tầng Web (`Aqt.CoreFW.Web`)** - Xem chi tiết: [6.datacore-management-web-plan.md](./6.datacore-management-web-plan.md) (Chưa tạo)
- [ ] **Bước 7: Các bước triển khai và kiểm thử cuối cùng (Thực hiện thủ công)** - Xem chi tiết: [7.datacore-management-final-steps-plan.md](./7.datacore-management-final-steps-plan.md) (Chưa tạo) 