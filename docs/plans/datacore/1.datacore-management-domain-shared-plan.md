# Kế hoạch chi tiết: Tầng Domain.Shared (`Aqt.CoreFW.Domain.Shared`) - Quản lý Danh mục Dữ liệu Cốt lõi (DataCore Management)

Phần này mô tả các thành phần cần tạo hoặc cập nhật trong tầng `Aqt.CoreFW.Domain.Shared` cho chức năng quản lý Danh mục Dữ liệu Cốt lõi.

## 1. Constants

-   **Vị trí:** Tạo thư mục `src/Aqt.CoreFW.Domain.Shared/DataCores`
-   **Tệp:** Tạo file `DataCoreConsts.cs`
-   **Nội dung:**
    ```csharp
    // src/Aqt.CoreFW.Domain.Shared/DataCores/DataCoreConsts.cs
    namespace Aqt.CoreFW.DataCores;

    public static class DataCoreConsts
    {
        // !! Quan trọng: Cập nhật các giá trị MaxLength dựa trên datacore-srs.md hoặc yêu cầu cụ thể !!
        public const int MaxCodeLength = 50; // Từ datacore-srs.md (giả định, cần kiểm tra lại)
        public const int MaxNameLength = 250; // Từ datacore-srs.md (giả định, cần kiểm tra lại)
        public const int MaxDescriptionLength = 500; // Từ datacore-srs.md (giả định, cần kiểm tra lại)
    }
    ```

## 2. Enum Trạng thái (Status Enum)

-   **Mô tả:** Định nghĩa Enum `DataCoreStatus` để quản lý trạng thái Active/Inactive.
-   **Vị trí:** Tạo file `DataCoreStatus.cs` trong thư mục `src/Aqt.CoreFW.Domain.Shared/DataCores`
-   **Nội dung:**
    ```csharp
    // src/Aqt.CoreFW.Domain.Shared/DataCores/DataCoreStatus.cs
    namespace Aqt.CoreFW.DataCores;

    /// <summary>
    /// Enum định nghĩa trạng thái của Danh mục Dữ liệu Cốt lõi.
    /// </summary>
    public enum DataCoreStatus : byte
    {
        /// <summary>
        /// Danh mục không còn hoạt động.
        /// </summary>
        Inactive = 0, // Giữ giá trị 0

        /// <summary>
        /// Danh mục đang hoạt động và có thể sử dụng.
        /// </summary>
        Active = 1 // Giữ giá trị 1
    }
    ```

## 3. Error Codes (Sử dụng Partial Class)

-   **Bước 3.1: Kiểm tra file gốc**
    -   **Vị trí:** Mở file `src/Aqt.CoreFW.Domain.Shared/CoreFWDomainErrorCodes.cs`
    -   **Hành động:** Đảm bảo lớp đã được khai báo là `partial`. Nếu chưa, hãy thêm từ khóa `partial`.

-   **Bước 3.2: Tạo file partial cho DataCore**
    -   **Vị trí:** Tạo file mới trong thư mục `src/Aqt.CoreFW.Domain.Shared/DataCores/`
    -   **Tên file:** `CoreFWDomainErrorCodes.DataCores.cs`
    -   **Nội dung:**
        ```csharp
        // src/Aqt.CoreFW.Domain.Shared/DataCores/CoreFWDomainErrorCodes.DataCores.cs
        namespace Aqt.CoreFW;

        // Phần mở rộng của CoreFWDomainErrorCodes dành riêng cho DataCore
        public static partial class CoreFWDomainErrorCodes
        {
            // DataCore Error Codes
            // Định dạng: CoreFW:[ModuleName]:<Số thứ tự 5 chữ số>
            // !!! Quan trọng: Kiểm tra số thứ tự cuối cùng trong các file partial khác và sử dụng số duy nhất tiếp theo !!!
            // Giả sử DataGroups dùng 0008x, DataCores sẽ bắt đầu từ 00091. Cần kiểm tra lại số này!
            public const string DataCoreCodeAlreadyExists = "CoreFW:DataCores:00091"; // Cập nhật số!
            // Thêm các mã lỗi khác nếu cần thiết, ví dụ: không tìm thấy DataGroup tham chiếu
            public const string DataGroupNotFound = "CoreFW:DataCores:00092"; // Cập nhật số!
        }
        ```

## 4. Localization

-   **Vị trí:** Cập nhật các file `*.json` trong `src/Aqt.CoreFW.Domain.Shared/Localization/CoreFW` (quan trọng: bao gồm cả `en.json`, `vi.json` và các ngôn ngữ khác nếu có).
-   **Nội dung cần thêm vào phần `texts` của mỗi file:**

    -   **Ví dụ cho `en.json`:**
        ```json
        {
          // --- DataCore Management ---
          "Menu:DataCoreManagement": "Core Data Catalog Management",
          "Menu:DataCores": "Core Data Catalogs",
          "DataCores": "Core Data Catalogs",
          "NewDataCore": "New Core Data Catalog",
          "EditDataCore": "Edit Core Data Catalog",
          "Enum:DataCoreStatus.0": "Inactive",
          "Enum:DataCoreStatus.1": "Active",
          "DisplayName:DataCore.Code": "Code",
          "DisplayName:DataCore.Name": "Name",
          "DisplayName:DataCore.Status": "Status",
          "DisplayName:DataCore.Order": "Order",
          "DisplayName:DataCore.Description": "Description",
          "DisplayName:DataCore.DataGroupId": "Data Group",
          "SelectDataGroup": "Select Data Group",
          // "All": "All", // Dùng chung
          // "Active": "Active", // Dùng chung
          // "Inactive": "Inactive", // Dùng chung
          // "SuccessfullyDeleted": "Successfully deleted", // Dùng chung
          // "SuccessfullySaved": "Successfully saved", // Dùng chung
          // "AreYouSure": "Are you sure?", // Dùng chung
          "AreYouSureToDeleteDataCore": "Are you sure you want to delete this core data catalog: {0}?",
          // "ExportToExcel": "Export to Excel", // Dùng chung (nếu có)
          // "Search": "Search", // Dùng chung
          "Permission:DataCoreManagement": "Core Data Catalog Management", // Sử dụng tên nhóm quyền tương ứng
          "Permission:DataCores": "View Core Data Catalogs", // Sử dụng tên quyền tương ứng
          "Permission:DataCores.Create": "Create Core Data Catalogs",
          "Permission:DataCores.Update": "Update Core Data Catalogs",
          "Permission:DataCores.Delete": "Delete Core Data Catalogs",
          "Permission:DataCores.Export": "Export Core Data Catalogs", // (Nếu có)
          "DataCoreCodeAlreadyExists": "The core data catalog code '{0}' already exists.",
          "DataGroupNotFound": "The selected Data Group (ID: {0}) was not found.",
          // !! Quan trọng: Cập nhật số mã lỗi !!
          "ErrorCode:CoreFW:DataCores:00091": "The core data catalog code '{0}' already exists.",
          "ErrorCode:CoreFW:DataCores:00092": "The selected Data Group (ID: {0}) was not found.",
          // Thêm localization cho các mã lỗi khác nếu có
        }
        ```
    -   **Ví dụ cho `vi.json`:**
        ```json
        {
          // --- Quản lý Danh mục Dữ liệu Cốt lõi ---
          "Menu:DataCoreManagement": "Quản lý Danh mục DL Cốt lõi",
          "Menu:DataCores": "Danh mục DL Cốt lõi",
          "DataCores": "Danh mục Dữ liệu Cốt lõi",
          "NewDataCore": "Thêm mới Danh mục DL Cốt lõi",
          "EditDataCore": "Sửa Danh mục DL Cốt lõi",
          "Enum:DataCoreStatus.0": "Không hoạt động",
          "Enum:DataCoreStatus.1": "Hoạt động",
          "DisplayName:DataCore.Code": "Mã",
          "DisplayName:DataCore.Name": "Tên",
          "DisplayName:DataCore.Status": "Trạng thái",
          "DisplayName:DataCore.Order": "Thứ tự",
          "DisplayName:DataCore.Description": "Mô tả",
          "DisplayName:DataCore.DataGroupId": "Nhóm dữ liệu",
          "SelectDataGroup": "Chọn Nhóm dữ liệu",
          // "All": "Tất cả", // Dùng chung
          // "Active": "Hoạt động", // Dùng chung
          // "Inactive": "Không hoạt động", // Dùng chung
          // "SuccessfullyDeleted": "Đã xóa thành công", // Dùng chung
          // "SuccessfullySaved": "Đã lưu thành công", // Dùng chung
          // "AreYouSure": "Bạn có chắc không?", // Dùng chung
          "AreYouSureToDeleteDataCore": "Bạn có chắc muốn xóa danh mục dữ liệu cốt lõi này: {0}?",
          // "ExportToExcel": "Xuất Excel", // Dùng chung (nếu có)
          // "Search": "Tìm kiếm", // Dùng chung
          "Permission:DataCoreManagement": "Quản lý Danh mục DL Cốt lõi", // Sử dụng tên nhóm quyền tương ứng
          "Permission:DataCores": "Xem Danh mục DL Cốt lõi", // Sử dụng tên quyền tương ứng
          "Permission:DataCores.Create": "Tạo Danh mục DL Cốt lõi",
          "Permission:DataCores.Update": "Cập nhật Danh mục DL Cốt lõi",
          "Permission:DataCores.Delete": "Xóa Danh mục DL Cốt lõi",
          "Permission:DataCores.Export": "Xuất Danh mục DL Cốt lõi", // (Nếu có)
          "DataCoreCodeAlreadyExists": "Mã danh mục dữ liệu cốt lõi '{0}' đã tồn tại.",
          "DataGroupNotFound": "Không tìm thấy Nhóm Dữ liệu được chọn (ID: {0}).",
          // !! Quan trọng: Cập nhật số mã lỗi !!
          "ErrorCode:CoreFW:DataCores:00091": "Mã danh mục dữ liệu cốt lõi '{0}' đã tồn tại.",
          "ErrorCode:CoreFW:DataCores:00092": "Không tìm thấy Nhóm Dữ liệu được chọn (ID: {0}).",
          // Thêm localization cho các mã lỗi khác nếu có
        }
        ```
-   **Lưu ý:**
    -   Kiểm tra lại `DataCoreConsts` và đảm bảo các giá trị `Max...Length` khớp với yêu cầu từ `datacore-srs.md`. (Bạn cần xác minh lại giới hạn độ dài thực tế từ SRS).
    -   Đảm bảo các mã lỗi (`CoreFW:DataCores:xxxxx`) là duy nhất và tăng dần so với các module khác. **Bạn cần tự xác định số bắt đầu chính xác.**
    -   Thêm namespace `Aqt.CoreFW.DataCores` vào các file `.cs` mới tạo.
    -   Đảm bảo dịch và thêm các key localization vào tất cả các tệp ngôn ngữ khác mà bạn hỗ trợ. Các key được comment `// Dùng chung` có thể đã tồn tại, không cần thêm lại nếu đã có.
    -   Các quyền (`Permission:DataCore...`) cần được định nghĩa trong kế hoạch tổng thể hoặc một kế hoạch riêng về quyền, ở đây chỉ là khai báo sử dụng.

``` 