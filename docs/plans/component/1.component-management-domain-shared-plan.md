# Kế hoạch chi tiết: Tầng Domain.Shared (`Aqt.CoreFW.Domain.Shared`) - Quản lý Thành phần thủ tục (ProcedureComponent)

Phần này mô tả các thành phần cần tạo hoặc cập nhật trong tầng `Aqt.CoreFW.Domain.Shared` cho chức năng quản lý Thành phần thủ tục (ProcedureComponent). Kế hoạch này dựa trên yêu cầu trong `docs/srs/component-srs.md` và kế hoạch tổng thể `0.component-plan-v1.md`.

## 1. Constants

-   **Vị trí:** Tạo thư mục `src/Aqt.CoreFW.Domain.Shared/Components`
-   **Tệp:** Tạo file `ComponentConsts.cs`
-   **Nội dung:**
    ```csharp
    // src/Aqt.CoreFW.Domain.Shared/Components/ComponentConsts.cs
    namespace Aqt.CoreFW.Components;

    public static class ComponentConsts
    {
        // !! Quan trọng: Cập nhật các giá trị MaxLength dựa trên component-srs.md hoặc yêu cầu cụ thể !!
        // Giá trị dưới đây là giả định, cần kiểm tra lại với SRS.
        public const int MaxCodeLength = 50; // Giả định
        public const int MaxNameLength = 250; // Giả định
        public const int MaxDescriptionLength = 1000; // Giả định - Tăng độ dài cho mô tả
        public const int MaxTempPathLength = 500; // Giả định - Cho phép đường dẫn dài

        // Không cần MaxLength cho FormDefinition vì có thể là TEXT/NVARCHAR(MAX)
    }
    ```

## 2. Enums

### 2.1. Enum Trạng thái (Status Enum)

-   **Mô tả:** Định nghĩa Enum `ComponentStatus` để quản lý trạng thái Active/Inactive.
-   **Vị trí:** Tạo file `ComponentStatus.cs` trong thư mục `src/Aqt.CoreFW.Domain.Shared/Components`
-   **Nội dung:**
    ```csharp
    // src/Aqt.CoreFW.Domain.Shared/Components/ComponentStatus.cs
    namespace Aqt.CoreFW.Components;

    /// <summary>
    /// Enum định nghĩa trạng thái của Thành phần thủ tục.
    /// </summary>
    public enum ComponentStatus : byte
    {
        /// <summary>
        /// Thành phần không còn hoạt động.
        /// </summary>
        Inactive = 0,

        /// <summary>
        /// Thành phần đang hoạt động và có thể sử dụng.
        /// </summary>
        Active = 1
    }
    ```

### 2.2. Enum Loại (Type Enum)

-   **Mô tả:** Định nghĩa Enum `ComponentType` để quản lý loại Form/File.
-   **Vị trí:** Tạo file `ComponentType.cs` trong thư mục `src/Aqt.CoreFW.Domain.Shared/Components`
-   **Nội dung:**
    ```csharp
    // src/Aqt.CoreFW.Domain.Shared/Components/ComponentType.cs
    namespace Aqt.CoreFW.Components;

    /// <summary>
    /// Enum định nghĩa loại của Thành phần thủ tục.
    /// </summary>
    public enum ComponentType : byte
    {
        /// <summary>
        /// Thành phần yêu cầu định nghĩa Form (ví dụ: JSON).
        /// </summary>
        Form = 0,

        /// <summary>
        /// Thành phần yêu cầu đường dẫn đến file template.
        /// </summary>
        File = 1
    }
    ```

## 3. Error Codes (Sử dụng Partial Class)

-   **Bước 3.1: Kiểm tra file gốc**
    -   **Vị trí:** Mở file `src/Aqt.CoreFW.Domain.Shared/CoreFWDomainErrorCodes.cs`
    -   **Hành động:** Đảm bảo lớp đã được khai báo là `partial`. Nếu chưa, hãy thêm từ khóa `partial`.

-   **Bước 3.2: Tạo file partial cho Component**
    -   **Vị trí:** Tạo file mới trong thư mục `src/Aqt.CoreFW.Domain.Shared/Components/`
    -   **Tên file:** `CoreFWDomainErrorCodes.Components.cs`
    -   **Nội dung:**
        ```csharp
        // src/Aqt.CoreFW.Domain.Shared/Components/CoreFWDomainErrorCodes.Components.cs
        namespace Aqt.CoreFW;

        // Phần mở rộng của CoreFWDomainErrorCodes dành riêng cho Components
        public static partial class CoreFWDomainErrorCodes
        {
            // Components Error Codes
            // Định dạng: CoreFW:[ModuleName]:<Số thứ tự 5 chữ số>
            // !!! Quan trọng: Kiểm tra số thứ tự cuối cùng trong các file partial khác (ví dụ: Procedures, DataImportants, DataCores, DataGroups) và sử dụng số duy nhất tiếp theo !!!
            // Giả sử Procedures dùng 0011x, Components có thể bắt đầu từ 00121. Cần kiểm tra lại số này!
            public const string ComponentCodeAlreadyExists = "CoreFW:Components:00121"; // Cập nhật số!
            // Thêm các mã lỗi khác nếu cần (ví dụ: validate FormDefinition, TempPath, liên kết...)
        }
        ```

## 4. Localization

-   **Vị trí:** Cập nhật các file `*.json` trong `src/Aqt.CoreFW.Domain.Shared/Localization/CoreFW` (quan trọng: bao gồm cả `en.json`, `vi.json` và các ngôn ngữ khác nếu có).
-   **Nội dung cần thêm vào phần `texts` của mỗi file:**

    -   **Ví dụ cho `en.json`:**
        ```json
        {
          // --- Component Management ---
          "Menu:ComponentManagement": "Component Management",
          "Menu:Components": "Procedure Components",
          "Components": "Procedure Components",
          "NewComponent": "New Component",
          "EditComponent": "Edit Component",
          "Enum:ComponentStatus.0": "Inactive",
          "Enum:ComponentStatus.1": "Active",
          "Enum:ComponentType.0": "Form",
          "Enum:ComponentType.1": "File",
          "DisplayName:Component.Code": "Code",
          "DisplayName:Component.Name": "Name",
          "DisplayName:Component.Status": "Status",
          "DisplayName:Component.Order": "Order",
          "DisplayName:Component.Description": "Description",
          "DisplayName:Component.Type": "Type",
          "DisplayName:Component.FormDefinition": "Form Definition (JSON)",
          "DisplayName:Component.TempPath": "Template Path",
          "DisplayName:Component.Procedures": "Linked Procedures", // Cho quản lý liên kết
          "AreYouSureToDeleteComponent": "Are you sure you want to delete this component: {0}?",
          "Permission:ComponentManagement": "Component Management", // Từ kế hoạch tổng thể
          "Permission:Components": "View Components",
          "Permission:Components.Create": "Create Components",
          "Permission:Components.Update": "Update Components",
          "Permission:Components.Delete": "Delete Components",
          "Permission:Components.ManageProcedureLinks": "Manage Procedure Links", // Từ kế hoạch tổng thể
          "ComponentCodeAlreadyExists": "The component code '{0}' already exists.",
          // !! Quan trọng: Cập nhật số mã lỗi !!
          "ErrorCode:CoreFW:Components:00121": "The component code '{0}' already exists.",
          // Thêm localization cho các mã lỗi khác nếu có
        }
        ```
    -   **Ví dụ cho `vi.json`:**
        ```json
        {
          // --- Quản lý Thành phần thủ tục ---
          "Menu:ComponentManagement": "Quản lý thành phần",
          "Menu:Components": "Thành phần thủ tục",
          "Components": "Thành phần thủ tục",
          "NewComponent": "Thêm mới thành phần",
          "EditComponent": "Sửa thành phần",
          "Enum:ComponentStatus.0": "Không hoạt động",
          "Enum:ComponentStatus.1": "Hoạt động",
          "Enum:ComponentType.0": "Biểu mẫu (Form)",
          "Enum:ComponentType.1": "Tệp mẫu (File)",
          "DisplayName:Component.Code": "Mã",
          "DisplayName:Component.Name": "Tên",
          "DisplayName:Component.Status": "Trạng thái",
          "DisplayName:Component.Order": "Thứ tự",
          "DisplayName:Component.Description": "Mô tả",
          "DisplayName:Component.Type": "Loại",
          "DisplayName:Component.FormDefinition": "Định nghĩa Form (JSON)",
          "DisplayName:Component.TempPath": "Đường dẫn Template",
          "DisplayName:Component.Procedures": "Thủ tục liên kết", // Cho quản lý liên kết
          "AreYouSureToDeleteComponent": "Bạn có chắc muốn xóa thành phần này: {0}?",
          "Permission:ComponentManagement": "Quản lý thành phần", // Từ kế hoạch tổng thể
          "Permission:Components": "Xem thành phần",
          "Permission:Components.Create": "Tạo thành phần",
          "Permission:Components.Update": "Cập nhật thành phần",
          "Permission:Components.Delete": "Xóa thành phần",
          "Permission:Components.ManageProcedureLinks": "Quản lý liên kết thủ tục", // Từ kế hoạch tổng thể
          "ComponentCodeAlreadyExists": "Mã thành phần '{0}' đã tồn tại.",
          // !! Quan trọng: Cập nhật số mã lỗi !!
          "ErrorCode:CoreFW:Components:00121": "Mã thành phần '{0}' đã tồn tại.",
          // Thêm localization cho các mã lỗi khác nếu có
        }
        ```
-   **Lưu ý quan trọng:**
    -   **Xác minh:** Kiểm tra lại `ComponentConsts` và đảm bảo các giá trị `Max...Length` khớp với yêu cầu từ `component-srs.md` hoặc các quyết định thiết kế cuối cùng.
    -   **Mã lỗi duy nhất:** Đảm bảo các mã lỗi (`CoreFW:Components:xxxxx`) là duy nhất và tăng dần so với các module khác (Procedures, DataCore, DataGroup, DataImportants, v.v.). **Bạn cần tự xác định số bắt đầu chính xác bằng cách kiểm tra các file `CoreFWDomainErrorCodes.*.cs` khác trong dự án.** Con số `00121` ở đây là giả định và cần được xác minh.
    -   **Namespace:** Thêm namespace `Aqt.CoreFW.Components` vào các file `.cs` mới tạo.
    -   **Đa ngôn ngữ:** Dịch và thêm các key localization vào tất cả các tệp ngôn ngữ khác mà dự án hỗ trợ. Các key chung (như `All`, `Active`, ...) có thể đã tồn tại, không cần thêm lại.
    -   **Quyền:** Các quyền (`Permission:Components...`) đã được định nghĩa trong kế hoạch tổng thể `0.component-plan-v1.md`. Ở đây chỉ là khai báo sử dụng trong localization.
    -   **Thông báo lỗi:** Câu chữ trong localization của mã lỗi cần phản ánh đúng quy tắc nghiệp vụ (ví dụ: tính duy nhất của mã).
</rewritten_file> 