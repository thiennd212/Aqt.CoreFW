# Kế hoạch chi tiết: Tầng Domain.Shared (`Aqt.CoreFW.Domain.Shared`) - Quản lý Attached Document (AttachedDocument Management)

Phần này mô tả các thành phần cần tạo hoặc cập nhật trong tầng `Aqt.CoreFW.Domain.Shared` cho chức năng quản lý Attached Document. Kế hoạch này dựa trên yêu cầu trong `docs/srs/hosodinhkem-srs.md` và kế hoạch tổng thể `0.hosodinhkem-plan-v1.md`.

## 1. Constants

-   **Vị trí:** Tạo thư mục `src/Aqt.CoreFW.Domain.Shared/AttachedDocuments`
-   **Tệp:** Tạo file `AttachedDocumentConsts.cs`
-   **Nội dung:**
    ```csharp
    // src/Aqt.CoreFW.Domain.Shared/AttachedDocuments/AttachedDocumentConsts.cs
    namespace Aqt.CoreFW.AttachedDocuments;

    public static class AttachedDocumentConsts
    {
        // !! Quan trọng: Cập nhật các giá trị MaxLength dựa trên hosodinhkem-srs.md hoặc yêu cầu cụ thể !!
        // Giá trị dưới đây là giả định, cần kiểm tra lại với SRS.
        public const int MaxCodeLength = 50; // Xác minh lại
        public const int MaxNameLength = 250; // Xác minh lại
        public const int MaxDescriptionLength = 500; // Xác minh lại
    }
    ```

## 2. Enum Trạng thái (Status Enum)

-   **Mô tả:** Định nghĩa Enum `AttachedDocumentStatus` để quản lý trạng thái Active/Inactive.
-   **Vị trí:** Tạo file `AttachedDocumentStatus.cs` trong thư mục `src/Aqt.CoreFW.Domain.Shared/AttachedDocuments`
-   **Nội dung:**
    ```csharp
    // src/Aqt.CoreFW.Domain.Shared/AttachedDocuments/AttachedDocumentStatus.cs
    namespace Aqt.CoreFW.AttachedDocuments;

    /// <summary>
    /// Enum định nghĩa trạng thái của Attached Document.
    /// </summary>
    public enum AttachedDocumentStatus : byte
    {
        /// <summary>
        /// Attached document không còn hoạt động.
        /// </summary>
        Inactive = 0,

        /// <summary>
        /// Attached document đang hoạt động và có thể sử dụng.
        /// </summary>
        Active = 1
    }
    ```

## 3. Error Codes (Sử dụng Partial Class)

-   **Bước 3.1: Kiểm tra file gốc**
    -   **Vị trí:** Mở file `src/Aqt.CoreFW.Domain.Shared/CoreFWDomainErrorCodes.cs`
    -   **Hành động:** Đảm bảo lớp đã được khai báo là `partial`. Nếu chưa, hãy thêm từ khóa `partial`.

-   **Bước 3.2: Tạo file partial cho AttachedDocument**
    -   **Vị trí:** Tạo file mới trong thư mục `src/Aqt.CoreFW.Domain.Shared/AttachedDocuments/`
    -   **Tên file:** `CoreFWDomainErrorCodes.AttachedDocuments.cs`
    -   **Nội dung:**
        ```csharp
        // src/Aqt.CoreFW.Domain.Shared/AttachedDocuments/CoreFWDomainErrorCodes.AttachedDocuments.cs
        namespace Aqt.CoreFW;

        // Phần mở rộng của CoreFWDomainErrorCodes dành riêng cho AttachedDocument
        public static partial class CoreFWDomainErrorCodes
        {
            // AttachedDocument Error Codes
            // Định dạng: CoreFW:[ModuleName]:<Số thứ tự 5 chữ số>
            // !!! Quan trọng: Kiểm tra số thứ tự cuối cùng trong các file partial khác (ví dụ: DataImportants, DataCores) và sử dụng số duy nhất tiếp theo !!!
            // Giả sử DataImportants dùng đến 0010x, AttachedDocuments có thể bắt đầu từ 00111. Cần kiểm tra lại số này!
            public const string AttachedDocumentCodeAlreadyExists = "CoreFW:AttachedDocuments:00111"; // Cập nhật số!
            public const string ProcedureNotFoundForAttachedDocument = "CoreFW:AttachedDocuments:00112"; // Cập nhật số!
            // Thêm các mã lỗi khác nếu cần thiết
        }
        ```

## 4. Localization

-   **Vị trí:** Cập nhật các file `*.json` trong `src/Aqt.CoreFW.Domain.Shared/Localization/CoreFW` (quan trọng: bao gồm cả `en.json`, `vi.json` và các ngôn ngữ khác nếu có).
-   **Nội dung cần thêm vào phần `texts` của mỗi file:**

    -   **Ví dụ cho `en.json`:**
        ```json
        {
          // --- Attached Document Management ---
          "Menu:AttachedDocumentManagement": "Attached Document Management",
          "Menu:AttachedDocuments": "Attached Documents",
          "AttachedDocuments": "Attached Documents",
          "NewAttachedDocument": "New Attached Document",
          "EditAttachedDocument": "Edit Attached Document",
          "Enum:AttachedDocumentStatus.0": "Inactive",
          "Enum:AttachedDocumentStatus.1": "Active",
          "DisplayName:AttachedDocument.Code": "Code",
          "DisplayName:AttachedDocument.Name": "Name",
          "DisplayName:AttachedDocument.Status": "Status",
          "DisplayName:AttachedDocument.Order": "Order",
          "DisplayName:AttachedDocument.Description": "Description",
          "DisplayName:AttachedDocument.ProcedureId": "Procedure",
          "SelectProcedure": "Select Procedure", // Cần kiểm tra nếu đã có key tương tự từ module Procedure
          "AreYouSureToDeleteAttachedDocument": "Are you sure you want to delete this attached document: {0}?",
          "Permission:AttachedDocumentManagement": "Attached Document Management", // Từ kế hoạch tổng thể
          "Permission:AttachedDocuments": "View Attached Documents",
          "Permission:AttachedDocuments.Create": "Create Attached Documents",
          "Permission:AttachedDocuments.Update": "Update Attached Documents",
          "Permission:AttachedDocuments.Delete": "Delete Attached Documents",
          "Permission:AttachedDocuments.Export": "Export Attached Documents", // (Nếu có Export)
          "AttachedDocumentCodeAlreadyExists": "The attached document code '{0}' already exists for the selected Procedure.", // Cập nhật thông báo nếu logic khác
          "ProcedureNotFoundForAttachedDocument": "The selected Procedure (ID: {0}) was not found.",
          // !! Quan trọng: Cập nhật số mã lỗi !!
          "ErrorCode:CoreFW:AttachedDocuments:00111": "The attached document code '{0}' already exists for the selected Procedure.", // Cập nhật thông báo nếu logic khác
          "ErrorCode:CoreFW:AttachedDocuments:00112": "The selected Procedure (ID: {0}) was not found.",
          // Thêm localization cho các mã lỗi khác nếu có
        }
        ```
    -   **Ví dụ cho `vi.json`:**
        ```json
        {
          // --- Quản lý Hồ sơ đính kèm ---
          "Menu:AttachedDocumentManagement": "Quản lý Hồ sơ đính kèm",
          "Menu:AttachedDocuments": "Hồ sơ đính kèm",
          "AttachedDocuments": "Hồ sơ đính kèm",
          "NewAttachedDocument": "Thêm mới Hồ sơ đính kèm",
          "EditAttachedDocument": "Sửa Hồ sơ đính kèm",
          "Enum:AttachedDocumentStatus.0": "Không hoạt động",
          "Enum:AttachedDocumentStatus.1": "Hoạt động",
          "DisplayName:AttachedDocument.Code": "Mã",
          "DisplayName:AttachedDocument.Name": "Tên",
          "DisplayName:AttachedDocument.Status": "Trạng thái",
          "DisplayName:AttachedDocument.Order": "Thứ tự",
          "DisplayName:AttachedDocument.Description": "Mô tả",
          "DisplayName:AttachedDocument.ProcedureId": "Thủ tục Hành chính",
          "SelectProcedure": "Chọn Thủ tục Hành chính", // Cần kiểm tra
          "AreYouSureToDeleteAttachedDocument": "Bạn có chắc muốn xóa hồ sơ đính kèm này: {0}?",
          "Permission:AttachedDocumentManagement": "Quản lý Hồ sơ đính kèm", // Từ kế hoạch tổng thể
          "Permission:AttachedDocuments": "Xem Hồ sơ đính kèm",
          "Permission:AttachedDocuments.Create": "Tạo Hồ sơ đính kèm",
          "Permission:AttachedDocuments.Update": "Cập nhật Hồ sơ đính kèm",
          "Permission:AttachedDocuments.Delete": "Xóa Hồ sơ đính kèm",
          "Permission:AttachedDocuments.Export": "Xuất Hồ sơ đính kèm", // (Nếu có Export)
          "AttachedDocumentCodeAlreadyExists": "Mã hồ sơ đính kèm '{0}' đã tồn tại trong Thủ tục Hành chính được chọn.", // Cập nhật thông báo nếu logic khác
          "ProcedureNotFoundForAttachedDocument": "Không tìm thấy Thủ tục Hành chính được chọn (ID: {0}).",
          // !! Quan trọng: Cập nhật số mã lỗi !!
          "ErrorCode:CoreFW:AttachedDocuments:00111": "Mã hồ sơ đính kèm '{0}' đã tồn tại trong Thủ tục Hành chính được chọn.", // Cập nhật thông báo nếu logic khác
          "ErrorCode:CoreFW:AttachedDocuments:00112": "Không tìm thấy Thủ tục Hành chính được chọn (ID: {0}).",
          // Thêm localization cho các mã lỗi khác nếu có
        }
        ```
-   **Lưu ý quan trọng:**
    -   **Xác minh:** Kiểm tra lại `AttachedDocumentConsts` và đảm bảo các giá trị `Max...Length` khớp với yêu cầu từ `hosodinhkem-srs.md`.
    -   **Mã lỗi duy nhất:** Đảm bảo các mã lỗi (`CoreFW:AttachedDocuments:xxxxx`) là duy nhất và tăng dần so với các module khác (DataImportant, DataCore, v.v.). **Bạn cần tự xác định số bắt đầu chính xác (ví dụ: 00111).**
    -   **Namespace:** Thêm namespace `Aqt.CoreFW.AttachedDocuments` vào các file `.cs` mới tạo.
    -   **Đa ngôn ngữ:** Dịch và thêm các key localization vào tất cả các tệp ngôn ngữ khác mà dự án hỗ trợ. Các key chung (như `SelectProcedure`, `All`, `Active`, ...) có thể đã tồn tại từ module Thủ tục Hành chính hoặc các module khác, không cần thêm lại nếu trùng.
    -   **Quyền:** Các quyền (`Permission:AttachedDocument...`) đã được định nghĩa trong kế hoạch tổng thể `0.hosodinhkem-plan-v1.md`. Ở đây chỉ là khai báo sử dụng trong localization.
    -   **Thông báo lỗi:** Cập nhật lại câu chữ trong localization của mã lỗi (ví dụ: `AttachedDocumentCodeAlreadyExists`) để phản ánh đúng quy tắc nghiệp vụ (ví dụ: nếu mã chỉ cần duy nhất trong `ProcedureId` hay toàn hệ thống).

</rewritten_file> 