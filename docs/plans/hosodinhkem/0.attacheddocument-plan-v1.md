# Kế hoạch triển khai chức năng quản lý Attached Document (AttachedDocument Management) - v1

## 0. Phân tích nghiệp vụ

### 0.1. Mục tiêu
- Xây dựng chức năng cho phép người quản trị hệ thống hoặc người dùng được cấp quyền quản lý danh mục các Attached Document trong hệ thống.
- Mỗi AttachedDocument sẽ thuộc về một Thủ tục Hành chính (Procedure) đã được định nghĩa trước (theo yêu cầu tại `docs/srs/hosodinhkem-srs.md`).
- Đảm bảo dữ liệu AttachedDocument (Mã, Tên, Trạng thái, Thứ tự, Mô tả, IdProcedure) là nhất quán, chính xác.

### 0.2. Đối tượng sử dụng
- Quản trị viên hệ thống.
- Người dùng được cấp quyền quản lý danh mục Attached Document.

### 0.3. Yêu cầu chức năng chính (CRUD)
- **Xem danh sách (Read):** Hiển thị danh sách các AttachedDocument đã có trong hệ thống dưới dạng bảng. Hỗ trợ tìm kiếm theo Mã (`Code`) hoặc Tên (`Name`), lọc theo Trạng thái (`Status`), lọc theo Thủ tục Hành chính (`ProcedureId`). Hỗ trợ phân trang và sắp xếp theo các cột dữ liệu chính (Mã, Tên, Thứ tự, Trạng thái, Tên Thủ tục Hành chính).
- **Thêm mới (Create):** Cho phép người dùng thêm một AttachedDocument mới. Yêu cầu nhập Mã (`Code`), Tên (`Name`), Thứ tự hiển thị (`Order`), Mô tả (`Description` - tùy chọn), Trạng thái (`Status`), chọn Thủ tục Hành chính (`ProcedureId`).
- **Sửa (Update):** Cho phép người dùng chỉnh sửa thông tin (Tên, Thứ tự, Mô tả, Trạng thái, Thủ tục Hành chính) của một AttachedDocument đã tồn tại. Mã (`Code`) không được phép sửa sau khi tạo.
- **Xóa (Delete):** Cho phép người dùng xóa một AttachedDocument. Sử dụng cơ chế xóa mềm (Soft Delete). Cần có bước xác nhận trước khi xóa.
- **Xuất Excel (Export):** Cho phép người dùng xuất danh sách AttachedDocument (có thể dựa trên kết quả lọc hiện tại) ra file định dạng Excel. *(Optional)*

### 0.4. Yêu cầu dữ liệu (Dựa trên `docs/srs/hosodinhkem-srs.md`)
- **Mã (Code):**
    - Kiểu dữ liệu: Chuỗi (`string`).
    - Bắt buộc nhập.
    - Độ dài tối đa: `AttachedDocumentConsts.MaxCodeLength`.
    - Phải là duy nhất (unique) trong cùng một `ProcedureId` (cần xác nhận lại yêu cầu này, có thể cần duy nhất toàn hệ thống).
- **Tên (Name):**
    - Kiểu dữ liệu: Chuỗi (`string`).
    - Bắt buộc nhập.
    - Độ dài tối đa: `AttachedDocumentConsts.MaxNameLength`.
- **Trạng thái (Status):**
    - Kiểu dữ liệu: Enum `AttachedDocumentStatus` (`Active`, `Inactive`).
    - Bắt buộc.
    - Giá trị mặc định: `Active`.
- **Thứ tự hiển thị (Order):**
    - Kiểu dữ liệu: Số nguyên (`int`).
    - Bắt buộc.
    - Giá trị mặc định: `0`.
- **Mô tả (Description):**
    - Kiểu dữ liệu: Chuỗi (`string`).
    - Không bắt buộc.
    - Độ dài tối đa: `AttachedDocumentConsts.MaxDescriptionLength`.
- **Id Thủ tục Hành chính (ProcedureId):**
    - Kiểu dữ liệu: `Guid`.
    - Bắt buộc.
    - Tham chiếu đến khóa chính của `Procedure`.
- **Thông tin Audit:** Kế thừa từ `FullAuditedEntity<Guid>` để lưu thông tin tạo/sửa/xóa. (Lưu ý: Có thể là `FullAuditedAggregateRoot<Guid>` nếu AttachedDocument là một Aggregate Root độc lập).

### 0.5. Yêu cầu giao diện người dùng (UI)
- **Màn hình danh sách:**
    - Ô tìm kiếm chung (lọc theo Mã hoặc Tên).
    - Bộ lọc Trạng thái (dropdown: "Tất cả", "Hoạt động", "Không hoạt động").
    - Bộ lọc Thủ tục Hành chính (dropdown/lookup).
    - Bảng hiển thị các cột: Mã, Tên, Thứ tự, Trạng thái, Tên Thủ tục Hành chính.
    - Nút "Thêm mới Attached Document".
    - Các nút hành động (Sửa, Xóa) trên mỗi dòng của bảng.
    - Phân trang.
- **Modal Thêm mới/Sửa:**
    - Form nhập liệu cho Mã (chỉ cho phép nhập khi thêm mới), Tên, Thứ tự, Mô tả, Trạng thái (checkbox/radio), Thủ tục Hành chính (dropdown/lookup).
    - Các nút Lưu và Hủy.

### 0.6. Yêu cầu về phân quyền
- Định nghĩa nhóm quyền: `CoreFW.AttachedDocumentManagement`.
- Các quyền cụ thể:
    - `CoreFW.AttachedDocumentManagement.AttachedDocuments` (Quyền xem danh sách - mặc định)
    - `CoreFW.AttachedDocumentManagement.AttachedDocuments.Create`
    - `CoreFW.AttachedDocumentManagement.AttachedDocuments.Update`
    - `CoreFW.AttachedDocumentManagement.AttachedDocuments.Delete`
    - `CoreFW.AttachedDocumentManagement.AttachedDocuments.Export` *(Nếu triển khai chức năng Export)*
- Giao diện cần ẩn/hiện các nút chức năng dựa trên quyền của người dùng đang đăng nhập.

### 0.7. Quy tắc nghiệp vụ
- Mã (`Code`) phải là duy nhất trong phạm vi một `ProcedureId` (cần xác nhận lại).
- Khi thêm mới hoặc sửa, phải kiểm tra tính duy nhất của Mã (trong phạm vi `ProcedureId`, bỏ qua bản ghi hiện tại khi sửa).
- Khi thêm mới hoặc sửa, phải kiểm tra `ProcedureId` được chọn có tồn tại và hợp lệ.
- Tên (`Name`) không yêu cầu là duy nhất.

**Lưu ý chung:** Luôn luôn cập nhật kết quả mỗi bước sau khi hoàn thành vào tệp kế hoạch tương ứng.

## Tóm tắt Tiến độ Thực hiện Dự kiến

- [x] **Bước 0: Kế hoạch tổng thể** - File này
- [ ] **Bước 1: Tầng Domain.Shared (`Aqt.CoreFW.Domain.Shared`)** - Xem chi tiết: [1.attacheddocument-management-domain-shared-plan.md](./1.attacheddocument-management-domain-shared-plan.md) (Đã cập nhật)
- [ ] **Bước 2: Tầng Domain (`Aqt.CoreFW.Domain`)** - Xem chi tiết: [2.attacheddocument-management-domain-plan.md](./2.attacheddocument-management-domain-plan.md) (Chưa tạo)
- [ ] **Bước 3: Tầng Application.Contracts (`Aqt.CoreFW.Application.Contracts`)** - Xem chi tiết: [3.attacheddocument-management-app-contracts-plan.md](./3.attacheddocument-management-app-contracts-plan.md) (Chưa tạo)
- [ ] **Bước 4: Tầng Application (`Aqt.CoreFW.Application`)** - Xem chi tiết: [4.attacheddocument-management-application-plan.md](./4.attacheddocument-management-application-plan.md) (Chưa tạo)
- [ ] **Bước 5: Tầng EntityFrameworkCore (`Aqt.CoreFW.EntityFrameworkCore`)** - Xem chi tiết: [5.attacheddocument-management-efcore-plan.md](./5.attacheddocument-management-efcore-plan.md) (Chưa tạo)
- [ ] **Bước 6: Tầng Web (`Aqt.CoreFW.Web`)** - Xem chi tiết: [6.attacheddocument-management-web-plan.md](./6.attacheddocument-management-web-plan.md) (Chưa tạo)
- [ ] **Bước 7: Các bước triển khai và kiểm thử cuối cùng (Thực hiện thủ công)** - Xem chi tiết: [7.attacheddocument-management-final-steps-plan.md](./7.attacheddocument-management-final-steps-plan.md) (Chưa tạo) 