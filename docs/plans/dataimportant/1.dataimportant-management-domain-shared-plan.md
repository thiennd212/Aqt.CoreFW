# Kế hoạch chi tiết: Tầng Domain.Shared (`Aqt.CoreFW.Domain.Shared`) - Quản lý Danh mục Dữ liệu Quan trọng (DataImportant Management)

Phần này mô tả các thành phần cần tạo hoặc cập nhật trong tầng `Aqt.CoreFW.Domain.Shared` cho chức năng quản lý Danh mục Dữ liệu Quan trọng (DataImportant). Kế hoạch này dựa trên yêu cầu trong `docs/srs/dataimportant-srs.md` và kế hoạch tổng thể `0.dataimportant-management-plan-v1.md`.

## 1. Constants

-   **Vị trí:** Tạo thư mục `src/Aqt.CoreFW.Domain.Shared/DataImportants`
-   **Tệp:** Tạo file `DataImportantConsts.cs`
-   **Nội dung:**
    ```csharp
    // src/Aqt.CoreFW.Domain.Shared/DataImportants/DataImportantConsts.cs
    namespace Aqt.CoreFW.DataImportants;

    public static class DataImportantConsts
    {
        // !! Quan trọng: Cập nhật các giá trị MaxLength dựa trên dataimportant-srs.md hoặc yêu cầu cụ thể !!
        // Giá trị dưới đây là giả định, cần kiểm tra lại với SRS.
        public const int MaxCodeLength = 50;
        public const int MaxNameLength = 250;
        public const int MaxDescriptionLength = 500;
    }
    ```

## 2. Enum Trạng thái (Status Enum)

-   **Mô tả:** Định nghĩa Enum `DataImportantStatus` để quản lý trạng thái Active/Inactive.
-   **Vị trí:** Tạo file `DataImportantStatus.cs` trong thư mục `src/Aqt.CoreFW.Domain.Shared/DataImportants`
-   **Nội dung:**
    ```csharp
    // src/Aqt.CoreFW.Domain.Shared/DataImportants/DataImportantStatus.cs
    namespace Aqt.CoreFW.DataImportants;

    /// <summary>
    /// Enum định nghĩa trạng thái của Danh mục Dữ liệu Quan trọng.
    /// </summary>
    public enum DataImportantStatus : byte
    {
        /// <summary>
        /// Danh mục không còn hoạt động.
        /// </summary>
        Inactive = 0,

        /// <summary>
        /// Danh mục đang hoạt động và có thể sử dụng.
        /// </summary>
        Active = 1
    }
    ```

## 3. Error Codes (Sử dụng Partial Class)

-   **Bước 3.1: Kiểm tra file gốc**
    -   **Vị trí:** Mở file `src/Aqt.CoreFW.Domain.Shared/CoreFWDomainErrorCodes.cs`
    -   **Hành động:** Đảm bảo lớp đã được khai báo là `partial`. Nếu chưa, hãy thêm từ khóa `partial`.

-   **Bước 3.2: Tạo file partial cho DataImportant**
    -   **Vị trí:** Tạo file mới trong thư mục `src/Aqt.CoreFW.Domain.Shared/DataImportants/`
    -   **Tên file:** `CoreFWDomainErrorCodes.DataImportants.cs`
    -   **Nội dung:**
        ```csharp
        // src/Aqt.CoreFW.Domain.Shared/DataImportants/CoreFWDomainErrorCodes.DataImportants.cs
        namespace Aqt.CoreFW;

        // Phần mở rộng của CoreFWDomainErrorCodes dành riêng cho DataImportant
        public static partial class CoreFWDomainErrorCodes
        {
            // DataImportant Error Codes
            // Định dạng: CoreFW:[ModuleName]:<Số thứ tự 5 chữ số>
            // !!! Quan trọng: Kiểm tra số thứ tự cuối cùng trong các file partial khác (ví dụ: DataCores) và sử dụng số duy nhất tiếp theo !!!
            // Giả sử DataCores dùng 0009x, DataImportants có thể bắt đầu từ 00101. Cần kiểm tra lại số này!
            public const string DataImportantCodeAlreadyExists = "CoreFW:DataImportants:00101"; // Cập nhật số!
            // Thêm mã lỗi DataGroupNotFound vì DataImportant cũng tham chiếu đến DataGroup
            public const string DataGroupNotFoundForImportant = "CoreFW:DataImportants:00102"; // Cập nhật số! (Sử dụng tên khác để phân biệt nếu cần)
            // Thêm các mã lỗi khác nếu cần thiết
        }
        ```

## 4. Localization

-   **Vị trí:** Cập nhật các file `*.json` trong `src/Aqt.CoreFW.Domain.Shared/Localization/CoreFW` (quan trọng: bao gồm cả `en.json`, `vi.json` và các ngôn ngữ khác nếu có).
-   **Nội dung cần thêm vào phần `texts` của mỗi file:**

    -   **Ví dụ cho `en.json`:**
        ```json
        {
          // --- DataImportant Management ---
          "Menu:DataImportantManagement": "Important Data Catalog Management",
          "Menu:DataImportants": "Important Data Catalogs",
          "DataImportants": "Important Data Catalogs",
          "NewDataImportant": "New Important Data Catalog",
          "EditDataImportant": "Edit Important Data Catalog",
          "Enum:DataImportantStatus.0": "Inactive",
          "Enum:DataImportantStatus.1": "Active",
          "DisplayName:DataImportant.Code": "Code",
          "DisplayName:DataImportant.Name": "Name",
          "DisplayName:DataImportant.Status": "Status",
          "DisplayName:DataImportant.Order": "Order",
          "DisplayName:DataImportant.Description": "Description",
          "DisplayName:DataImportant.DataGroupId": "Data Group",
          // "SelectDataGroup": "Select Data Group", // Có thể dùng chung từ DataCore hoặc DataGroup
          "AreYouSureToDeleteDataImportant": "Are you sure you want to delete this important data catalog: {0}?",
          "Permission:DataImportantManagement": "Important Data Catalog Management", // Từ kế hoạch tổng thể
          "Permission:DataImportants": "View Important Data Catalogs",
          "Permission:DataImportants.Create": "Create Important Data Catalogs",
          "Permission:DataImportants.Update": "Update Important Data Catalogs",
          "Permission:DataImportants.Delete": "Delete Important Data Catalogs",
          "Permission:DataImportants.Export": "Export Important Data Catalogs", // (Nếu có Export)
          "DataImportantCodeAlreadyExists": "The important data catalog code '{0}' already exists for the selected Data Group.", // Cập nhật thông báo nếu logic khác
          "DataGroupNotFoundForImportant": "The selected Data Group (ID: {0}) was not found.", // Thông báo lỗi cụ thể hơn nếu cần
          // !! Quan trọng: Cập nhật số mã lỗi !!
          "ErrorCode:CoreFW:DataImportants:00101": "The important data catalog code '{0}' already exists for the selected Data Group.", // Cập nhật thông báo nếu logic khác
          "ErrorCode:CoreFW:DataImportants:00102": "The selected Data Group (ID: {0}) was not found.",
          // Thêm localization cho các mã lỗi khác nếu có
        }
        ```
    -   **Ví dụ cho `vi.json`:**
        ```json
        {
          // --- Quản lý Danh mục Dữ liệu Quan trọng ---
          "Menu:DataImportantManagement": "Quản lý dữ liệu quan trọng",
          "Menu:DataImportants": "dữ liệu quan trọng",
          "DataImportants": "Danh mục Dữ liệu Quan trọng",
          "NewDataImportant": "Thêm mới dữ liệu quan trọng",
          "EditDataImportant": "Sửa dữ liệu quan trọng",
          "Enum:DataImportantStatus.0": "Không hoạt động",
          "Enum:DataImportantStatus.1": "Hoạt động",
          "DisplayName:DataImportant.Code": "Mã",
          "DisplayName:DataImportant.Name": "Tên",
          "DisplayName:DataImportant.Status": "Trạng thái",
          "DisplayName:DataImportant.Order": "Thứ tự",
          "DisplayName:DataImportant.Description": "Mô tả",
          "DisplayName:DataImportant.DataGroupId": "Nhóm dữ liệu",
          // "SelectDataGroup": "Chọn Nhóm dữ liệu", // Có thể dùng chung
          "AreYouSureToDeleteDataImportant": "Bạn có chắc muốn xóa danh mục dữ liệu quan trọng này: {0}?",
          "Permission:DataImportantManagement": "Quản lý dữ liệu quan trọng", // Từ kế hoạch tổng thể
          "Permission:DataImportants": "Xem dữ liệu quan trọng",
          "Permission:DataImportants.Create": "Tạo dữ liệu quan trọng",
          "Permission:DataImportants.Update": "Cập nhật dữ liệu quan trọng",
          "Permission:DataImportants.Delete": "Xóa dữ liệu quan trọng",
          "Permission:DataImportants.Export": "Xuất dữ liệu quan trọng", // (Nếu có Export)
          "DataImportantCodeAlreadyExists": "Mã danh mục dữ liệu quan trọng '{0}' đã tồn tại trong Nhóm Dữ liệu được chọn.", // Cập nhật thông báo nếu logic khác
          "DataGroupNotFoundForImportant": "Không tìm thấy Nhóm Dữ liệu được chọn (ID: {0}).", // Thông báo lỗi cụ thể hơn nếu cần
          // !! Quan trọng: Cập nhật số mã lỗi !!
          "ErrorCode:CoreFW:DataImportants:00101": "Mã danh mục dữ liệu quan trọng '{0}' đã tồn tại trong Nhóm Dữ liệu được chọn.", // Cập nhật thông báo nếu logic khác
          "ErrorCode:CoreFW:DataImportants:00102": "Không tìm thấy Nhóm Dữ liệu được chọn (ID: {0}).",
          // Thêm localization cho các mã lỗi khác nếu có
        }
        ```
-   **Lưu ý quan trọng:**
    -   **Xác minh:** Kiểm tra lại `DataImportantConsts` và đảm bảo các giá trị `Max...Length` khớp với yêu cầu từ `dataimportant-srs.md`.
    -   **Mã lỗi duy nhất:** Đảm bảo các mã lỗi (`CoreFW:DataImportants:xxxxx`) là duy nhất và tăng dần so với các module khác (DataCore, DataGroup, v.v.). **Bạn cần tự xác định số bắt đầu chính xác.**
    -   **Namespace:** Thêm namespace `Aqt.CoreFW.DataImportants` vào các file `.cs` mới tạo.
    -   **Đa ngôn ngữ:** Dịch và thêm các key localization vào tất cả các tệp ngôn ngữ khác mà dự án hỗ trợ. Các key chung (như `SelectDataGroup`, `All`, `Active`, ...) có thể đã tồn tại, không cần thêm lại.
    -   **Quyền:** Các quyền (`Permission:DataImportant...`) đã được định nghĩa trong kế hoạch tổng thể `0.dataimportant-management-plan-v1.md`. Ở đây chỉ là khai báo sử dụng trong localization.
    -   **Thông báo lỗi:** Cập nhật lại câu chữ trong localization của mã lỗi (ví dụ: `DataImportantCodeAlreadyExists`) để phản ánh đúng quy tắc nghiệp vụ (ví dụ: nếu mã chỉ cần duy nhất trong `DataGroupId` hay toàn hệ thống).
