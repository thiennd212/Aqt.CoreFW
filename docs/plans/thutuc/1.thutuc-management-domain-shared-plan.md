# Kế hoạch chi tiết: Tầng Domain.Shared (`Aqt.CoreFW.Domain.Shared`) - Quản lý Thủ tục hành chính (Procedure)

Phần này mô tả các thành phần cần tạo hoặc cập nhật trong tầng `Aqt.CoreFW.Domain.Shared` cho chức năng quản lý Thủ tục hành chính (Procedure). Kế hoạch này dựa trên yêu cầu trong `docs/srs/thutuc-srs.md` và kế hoạch tổng thể `0.thutuc-plan-v1.md`.

## 1. Constants

-   **Vị trí:** Tạo thư mục `src/Aqt.CoreFW.Domain.Shared/Procedures`
-   **Tệp:** Tạo file `ProcedureConsts.cs`
-   **Nội dung:**
    ```csharp
    // src/Aqt.CoreFW.Domain.Shared/Procedures/ProcedureConsts.cs
    namespace Aqt.CoreFW.Procedures;

    public static class ProcedureConsts
    {
        // !! Quan trọng: Cập nhật các giá trị MaxLength dựa trên thutuc-srs.md hoặc yêu cầu cụ thể !!
        // Giá trị dưới đây là giả định, cần kiểm tra lại với SRS.
        public const int MaxCodeLength = 50; // Giả định
        public const int MaxNameLength = 250; // Giả định
        public const int MaxDescriptionLength = 500; // Giả định
        public const int MaxSyncRecordCodeLength = 100; // Giả định
    }
    ```

## 2. Enum Trạng thái (Status Enum)

-   **Mô tả:** Định nghĩa Enum `ProcedureStatus` để quản lý trạng thái Active/Inactive.
-   **Vị trí:** Tạo file `ProcedureStatus.cs` trong thư mục `src/Aqt.CoreFW.Domain.Shared/Procedures`
-   **Nội dung:**
    ```csharp
    // src/Aqt.CoreFW.Domain.Shared/Procedures/ProcedureStatus.cs
    namespace Aqt.CoreFW.Procedures;

    /// <summary>
    /// Enum định nghĩa trạng thái của Thủ tục hành chính.
    /// </summary>
    public enum ProcedureStatus : byte
    {
        /// <summary>
        /// Thủ tục không còn hoạt động.
        /// </summary>
        Inactive = 0,

        /// <summary>
        /// Thủ tục đang hoạt động và có thể sử dụng.
        /// </summary>
        Active = 1
    }
    ```

## 3. Error Codes (Sử dụng Partial Class)

-   **Bước 3.1: Kiểm tra file gốc**
    -   **Vị trí:** Mở file `src/Aqt.CoreFW.Domain.Shared/CoreFWDomainErrorCodes.cs`
    -   **Hành động:** Đảm bảo lớp đã được khai báo là `partial`. Nếu chưa, hãy thêm từ khóa `partial`.

-   **Bước 3.2: Tạo file partial cho Procedure**
    -   **Vị trí:** Tạo file mới trong thư mục `src/Aqt.CoreFW.Domain.Shared/Procedures/`
    -   **Tên file:** `CoreFWDomainErrorCodes.Procedures.cs`
    -   **Nội dung:**
        ```csharp
        // src/Aqt.CoreFW.Domain.Shared/Procedures/CoreFWDomainErrorCodes.Procedures.cs
        namespace Aqt.CoreFW;

        // Phần mở rộng của CoreFWDomainErrorCodes dành riêng cho Procedures
        public static partial class CoreFWDomainErrorCodes
        {
            // Procedures Error Codes
            // Định dạng: CoreFW:[ModuleName]:<Số thứ tự 5 chữ số>
            // !!! Quan trọng: Kiểm tra số thứ tự cuối cùng trong các file partial khác (ví dụ: DataImportants, DataCores, DataGroups) và sử dụng số duy nhất tiếp theo !!!
            // Giả sử DataImportants dùng 0010x, Procedures có thể bắt đầu từ 00111. Cần kiểm tra lại số này!
            public const string ProcedureCodeAlreadyExists = "CoreFW:Procedures:00111"; // Cập nhật số!
            // Thêm các mã lỗi khác nếu cần thiết (ví dụ: liên quan đến đồng bộ)
        }
        ```

## 4. Localization

-   **Vị trí:** Cập nhật các file `*.json` trong `src/Aqt.CoreFW.Domain.Shared/Localization/CoreFW` (quan trọng: bao gồm cả `en.json`, `vi.json` và các ngôn ngữ khác nếu có).
-   **Nội dung cần thêm vào phần `texts` của mỗi file:**

    -   **Ví dụ cho `en.json`:**
        ```json
        {
          // --- Procedure Management ---
          "Menu:ProcedureManagement": "Procedure Management",
          "Menu:Procedures": "Procedures",
          "Procedures": "Procedures",
          "NewProcedure": "New Procedure",
          "EditProcedure": "Edit Procedure",
          "Enum:ProcedureStatus.0": "Inactive",
          "Enum:ProcedureStatus.1": "Active",
          "DisplayName:Procedure.Code": "Code",
          "DisplayName:Procedure.Name": "Name",
          "DisplayName:Procedure.Status": "Status",
          "DisplayName:Procedure.Order": "Order",
          "DisplayName:Procedure.Description": "Description",
          "DisplayName:Procedure.LastSyncedDate": "Last Synced Date",
          "DisplayName:Procedure.SyncRecordId": "Sync Record ID",
          "DisplayName:Procedure.SyncRecordCode": "Sync Record Code",
          "AreYouSureToDeleteProcedure": "Are you sure you want to delete this procedure: {0}?",
          "Permission:ProcedureManagement": "Procedure Management", // Từ kế hoạch tổng thể
          "Permission:Procedures": "View Procedures",
          "Permission:Procedures.Create": "Create Procedures",
          "Permission:Procedures.Update": "Update Procedures",
          "Permission:Procedures.Delete": "Delete Procedures",
          "Permission:Procedures.Sync": "Sync Procedures", // (Nếu có chức năng Sync riêng)
          "Permission:Procedures.Export": "Export Procedures", // (Nếu có Export)
          "ProcedureCodeAlreadyExists": "The procedure code '{0}' already exists.",
          // !! Quan trọng: Cập nhật số mã lỗi !!
          "ErrorCode:CoreFW:Procedures:00111": "The procedure code '{0}' already exists.",
          // Thêm localization cho các mã lỗi khác nếu có
        }
        ```
    -   **Ví dụ cho `vi.json`:**
        ```json
        {
          // --- Quản lý Thủ tục hành chính ---
          "Menu:ProcedureManagement": "Quản lý thủ tục",
          "Menu:Procedures": "Thủ tục hành chính",
          "Procedures": "Thủ tục hành chính",
          "NewProcedure": "Thêm mới thủ tục",
          "EditProcedure": "Sửa thủ tục",
          "Enum:ProcedureStatus.0": "Không hoạt động",
          "Enum:ProcedureStatus.1": "Hoạt động",
          "DisplayName:Procedure.Code": "Mã",
          "DisplayName:Procedure.Name": "Tên",
          "DisplayName:Procedure.Status": "Trạng thái",
          "DisplayName:Procedure.Order": "Thứ tự",
          "DisplayName:Procedure.Description": "Mô tả",
          "DisplayName:Procedure.LastSyncedDate": "Ngày đồng bộ cuối",
          "DisplayName:Procedure.SyncRecordId": "ID bản ghi đồng bộ",
          "DisplayName:Procedure.SyncRecordCode": "Mã bản ghi đồng bộ",
          "AreYouSureToDeleteProcedure": "Bạn có chắc muốn xóa thủ tục này: {0}?",
          "Permission:ProcedureManagement": "Quản lý thủ tục", // Từ kế hoạch tổng thể
          "Permission:Procedures": "Xem thủ tục",
          "Permission:Procedures.Create": "Tạo thủ tục",
          "Permission:Procedures.Update": "Cập nhật thủ tục",
          "Permission:Procedures.Delete": "Xóa thủ tục",
          "Permission:Procedures.Sync": "Đồng bộ thủ tục", // (Nếu có chức năng Sync riêng)
          "Permission:Procedures.Export": "Xuất thủ tục", // (Nếu có Export)
          "ProcedureCodeAlreadyExists": "Mã thủ tục '{0}' đã tồn tại.",
          // !! Quan trọng: Cập nhật số mã lỗi !!
          "ErrorCode:CoreFW:Procedures:00111": "Mã thủ tục '{0}' đã tồn tại.",
          // Thêm localization cho các mã lỗi khác nếu có
        }
        ```
-   **Lưu ý quan trọng:**
    -   **Xác minh:** Kiểm tra lại `ProcedureConsts` và đảm bảo các giá trị `Max...Length` khớp với yêu cầu từ `thutuc-srs.md` hoặc các quyết định thiết kế cuối cùng.
    -   **Mã lỗi duy nhất:** Đảm bảo các mã lỗi (`CoreFW:Procedures:xxxxx`) là duy nhất và tăng dần so với các module khác (DataCore, DataGroup, DataImportants, v.v.). **Bạn cần tự xác định số bắt đầu chính xác bằng cách kiểm tra các file `CoreFWDomainErrorCodes.*.cs` khác trong dự án.**
    -   **Namespace:** Thêm namespace `Aqt.CoreFW.Procedures` vào các file `.cs` mới tạo.
    -   **Đa ngôn ngữ:** Dịch và thêm các key localization vào tất cả các tệp ngôn ngữ khác mà dự án hỗ trợ. Các key chung (như `All`, `Active`, ...) có thể đã tồn tại, không cần thêm lại.
    -   **Quyền:** Các quyền (`Permission:Procedures...`) đã được định nghĩa trong kế hoạch tổng thể `0.thutuc-plan-v1.md`. Ở đây chỉ là khai báo sử dụng trong localization.
    -   **Thông báo lỗi:** Câu chữ trong localization của mã lỗi cần phản ánh đúng quy tắc nghiệp vụ (ví dụ: tính duy nhất của mã). 