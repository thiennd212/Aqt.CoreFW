# Kế hoạch triển khai chức năng quản lý Thủ tục hành chính (Procedure) - v1

## 0. Phân tích nghiệp vụ

### 0.1. Mục tiêu
- Xây dựng chức năng cho phép người quản trị hệ thống hoặc người dùng được cấp quyền quản lý danh mục các Thủ tục hành chính (Procedure) trong hệ thống.
- Đảm bảo dữ liệu Thủ tục hành chính (Mã, Tên, Trạng thái, Thứ tự, Mô tả, Thông tin đồng bộ) là nhất quán, chính xác.

### 0.2. Đối tượng sử dụng
- Quản trị viên hệ thống.
- Người dùng được cấp quyền quản lý danh mục Thủ tục hành chính.

### 0.3. Yêu cầu chức năng chính (CRUD)
- **Xem danh sách (Read):** Hiển thị danh sách các Thủ tục hành chính đã có trong hệ thống dưới dạng bảng. Hỗ trợ tìm kiếm theo Mã (`Code`) hoặc Tên (`Name`), lọc theo Trạng thái (`Status`). Hỗ trợ phân trang và sắp xếp theo các cột dữ liệu chính (Mã, Tên, Thứ tự, Trạng thái).
- **Thêm mới (Create):** Cho phép người dùng thêm một Thủ tục hành chính mới. Yêu cầu nhập Mã (`Code`), Tên (`Name`), Thứ tự hiển thị (`Order`), Mô tả (`Description` - tùy chọn), Trạng thái (`Status`). Các trường đồng bộ (`LastSyncedDate`, `SyncRecordId`, `SyncRecordCode`) có thể được quản lý tự động hoặc không cho phép nhập trực tiếp.
- **Sửa (Update):** Cho phép người dùng chỉnh sửa thông tin (Tên, Thứ tự, Mô tả, Trạng thái) của một Thủ tục hành chính đã tồn tại. Mã (`Code`) không được phép sửa sau khi tạo. Các trường đồng bộ có thể được cập nhật tự động khi có sự kiện đồng bộ.
- **Xóa (Delete):** Cho phép người dùng xóa một Thủ tục hành chính. Sử dụng cơ chế xóa mềm (Soft Delete). Cần có bước xác nhận trước khi xóa.
- **Đồng bộ (Sync):** (Có thể là một chức năng riêng hoặc tích hợp) Cập nhật thông tin đồng bộ (`LastSyncedDate`, `SyncRecordId`, `SyncRecordCode`) khi có sự kiện đồng bộ dữ liệu từ nguồn khác.
- **Xuất Excel (Export):** (Tùy chọn) Cho phép người dùng xuất danh sách Thủ tục hành chính (có thể dựa trên kết quả lọc hiện tại) ra file định dạng Excel.

### 0.4. Yêu cầu dữ liệu (Dựa trên `docs/srs/thutuc-srs.md`)
- **Mã (Code):**
    - Kiểu dữ liệu: Chuỗi (`string`).
    - Bắt buộc nhập.
    - Độ dài tối đa: `ProcedureConsts.MaxCodeLength`. *(Giả định)*
    - Phải là duy nhất (unique) toàn hệ thống. *(Giả định, cần xác nhận)*
- **Tên (Name):**
    - Kiểu dữ liệu: Chuỗi (`string`).
    - Bắt buộc nhập.
    - Độ dài tối đa: `ProcedureConsts.MaxNameLength`. *(Giả định)*
- **Trạng thái (Status):**
    - Kiểu dữ liệu: Enum `ProcedureStatus` (`Active`, `Inactive`). *(Giả định)*
    - Bắt buộc.
    - Giá trị mặc định: `Active`.
- **Thứ tự hiển thị (Order):**
    - Kiểu dữ liệu: Số nguyên (`int`).
    - Bắt buộc.
    - Giá trị mặc định: `0`.
- **Mô tả (Description):**
    - Kiểu dữ liệu: Chuỗi (`string`).
    - Không bắt buộc.
    - Độ dài tối đa: `ProcedureConsts.MaxDescriptionLength`. *(Giả định)*
- **Ngày đồng bộ gần nhất (LastSyncedDate):**
    - Kiểu dữ liệu: `DateTime?`.
    - Không bắt buộc.
- **Id bản ghi đồng bộ (SyncRecordId):**
    - Kiểu dữ liệu: `Guid?`.
    - Không bắt buộc.
- **Mã bản ghi đồng bộ (SyncRecordCode):**
    - Kiểu dữ liệu: Chuỗi (`string`).
    - Không bắt buộc.
    - Độ dài tối đa: `ProcedureConsts.MaxSyncRecordCodeLength`. *(Giả định)*
- **Thông tin Audit:** Kế thừa từ `FullAuditedAggregateRoot<Guid>` để lưu thông tin tạo/sửa/xóa và xử lý domain events nếu cần. *(Giả định Procedure là Aggregate Root)*

### 0.5. Yêu cầu giao diện người dùng (UI)
- **Màn hình danh sách:**
    - Ô tìm kiếm chung (lọc theo Mã hoặc Tên).
    - Bộ lọc Trạng thái (dropdown: "Tất cả", "Hoạt động", "Không hoạt động").
    - Bảng hiển thị các cột: Mã, Tên, Thứ tự, Trạng thái.
    - Nút "Thêm mới Thủ tục".
    - Các nút hành động (Sửa, Xóa) trên mỗi dòng của bảng.
    - Phân trang.
- **Modal Thêm mới/Sửa:**
    - Form nhập liệu cho Mã (chỉ cho phép nhập khi thêm mới), Tên, Thứ tự, Mô tả, Trạng thái (checkbox/radio).
    - Các trường thông tin đồng bộ (Ngày đồng bộ, Id đồng bộ, Mã đồng bộ) có thể chỉ hiển thị (read-only) hoặc ẩn đi.
    - Các nút Lưu và Hủy.

### 0.6. Yêu cầu về phân quyền
- Định nghĩa nhóm quyền: `CoreFW.ProcedureManagement`.
- Các quyền cụ thể:
    - `CoreFW.ProcedureManagement.Procedures` (Quyền xem danh sách - mặc định)
    - `CoreFW.ProcedureManagement.Procedures.Create`
    - `CoreFW.ProcedureManagement.Procedures.Update`
    - `CoreFW.ProcedureManagement.Procedures.Delete`
    - `CoreFW.ProcedureManagement.Procedures.Sync` *(Nếu có chức năng đồng bộ riêng)*
    - `CoreFW.ProcedureManagement.Procedures.Export` *(Nếu triển khai chức năng Export)*
- Giao diện cần ẩn/hiện các nút chức năng dựa trên quyền của người dùng đang đăng nhập.

### 0.7. Quy tắc nghiệp vụ
- Mã (`Code`) phải là duy nhất toàn hệ thống. *(Giả định)*
- Khi thêm mới hoặc sửa, phải kiểm tra tính duy nhất của Mã (bỏ qua bản ghi hiện tại khi sửa).
- Tên (`Name`) không yêu cầu là duy nhất.
- Các trường thông tin đồng bộ được cập nhật thông qua quy trình đồng bộ riêng, không cho phép người dùng sửa trực tiếp qua form CRUD thông thường (trừ khi có yêu cầu đặc biệt).

**Lưu ý chung:** Luôn luôn cập nhật kết quả mỗi bước sau khi hoàn thành vào tệp kế hoạch tương ứng.

## Tóm tắt Tiến độ Thực hiện Dự kiến

- [x] **Bước 0: Kế hoạch tổng thể** - File này
- [ ] **Bước 1: Tầng Domain.Shared (`Aqt.CoreFW.Domain.Shared`)** - Xem chi tiết: `1.thutuc-management-domain-shared-plan.md` (Chưa tạo)
- [ ] **Bước 2: Tầng Domain (`Aqt.CoreFW.Domain`)** - Xem chi tiết: `2.thutuc-management-domain-plan.md` (Chưa tạo)
- [ ] **Bước 3: Tầng Application.Contracts (`Aqt.CoreFW.Application.Contracts`)** - Xem chi tiết: `3.thutuc-management-app-contracts-plan.md` (Chưa tạo)
- [ ] **Bước 4: Tầng Application (`Aqt.CoreFW.Application`)** - Xem chi tiết: `4.thutuc-management-application-plan.md` (Chưa tạo)
- [ ] **Bước 5: Tầng EntityFrameworkCore (`Aqt.CoreFW.EntityFrameworkCore`)** - Xem chi tiết: `5.thutuc-management-efcore-plan.md` (Chưa tạo)
- [ ] **Bước 6: Tầng Web (`Aqt.CoreFW.Web`)** - Xem chi tiết: `6.thutuc-management-web-plan.md` (Chưa tạo)
- [ ] **Bước 7: Các bước triển khai và kiểm thử cuối cùng (Thực hiện thủ công)** - Xem chi tiết: `7.thutuc-management-final-steps-plan.md` (Chưa tạo) 